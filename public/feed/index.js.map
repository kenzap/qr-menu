{"version":3,"file":"index.js","sources":["../../node_modules/@kenzap/k-cloud/index.js","../../src/feed/index.js"],"sourcesContent":["/**\n * @name initHeader\n * @description Initiates Kenzap Cloud extension header and related scripts. Verifies user sessions, handles SSO, does cloud space navigation, initializes i18n localization. \n * @param {object} response\n */\nexport const initHeader = (response) => {\n\n    // cache header from backend\n    if(response.header) localStorage.setItem('header', response.header);\n  \n    // load header to html if not present\n    if(!document.querySelector(\"#k-script\")){\n  \n        let child = document.createElement('div');\n        child.innerHTML = localStorage.getItem('header');\n        child = child.firstChild;\n        document.body.prepend(child);\n  \n        // run header scripts\n        Function(document.querySelector(\"#k-script\").innerHTML).call('test');\n    }\n  \n    // load locales if present\n    if(response.locale) window.i18n.init(response.locale); \n}\n\n/**\n * @name showLoader\n * @description Initiates full screen three dots loader.\n */\nexport const showLoader = () => {\n\n    let el = document.querySelector(\".loader\");\n    if (el) el.style.display = 'block';\n}\n\n/**\n * @name hideLoader\n * @description Removes full screen three dots loader.\n */\nexport const hideLoader = () => {\n\n    let el = document.querySelector(\".loader\");\n    if (el) el.style.display = 'none';\n}\n\n/**\n * @name initFooter\n * @description Removes full screen three dots loader.\n * @param {string} left - Text or html code to be present on the left bottom side of screen\n * @param {string} right - Text or html code to be present on the left bottom side of screen\n */\nexport const initFooter = (left, right) => {\n\n    document.querySelector(\"footer .row\").innerHTML = `\n    <div class=\"d-sm-flex justify-content-center justify-content-sm-between\">\n        <span class=\"text-muted text-center text-sm-left d-block d-sm-inline-block\">${left}</span>\n        <span class=\"float-none float-sm-right d-block mt-1 mt-sm-0 text-center text-muted\">${right}</span>\n    </div>`;\n}\n\n/**\n * @name link\n * @description Handles Cloud navigation links between extensions and its pages. Takes care of custom url parameters.\n * @param {string} slug - Any inbound link\n * \n * @returns {string} link - Returns original link with kenzp cloud space ID identifier.\n */\nexport const link = (slug) => {\n    \n    let urlParams = new URLSearchParams(window.location.search);\n    let sid = urlParams.get('sid') ? urlParams.get('sid') : \"\";\n\n    let postfix = slug.indexOf('?') == -1 ? '?sid='+sid : '&sid='+sid;\n\n    return slug + postfix;\n}\n\n/**\n * @name getSiteId\n * @description Gets current Kenzap Cloud space ID identifier from the URL.\n * \n * @returns {string} id - Kenzap Cloud space ID.\n */\nexport const getSiteId = () => {\n    \n    let urlParams = new URLSearchParams(window.location.search);\n    let id = urlParams.get('sid') ? urlParams.get('sid') : \"\";\n\n    return id;\n}\n\n/**\n * @name setCookie\n * @description Set cookie by its name to all .kenzap.com subdomains\n * @param {string} name - Cookie name.\n * @param {string} value - Cookie value.\n * @param {string} days - Number of days when cookie expires.\n */\n export const setCookie = (name, value, days) => {\n\n    let expires = \"\";\n    if (days) {\n        let date = new Date();\n        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n        expires = \";expires=\" + date.toUTCString();\n    }\n    d.cookie = name + \"=\" + (escape(value) || \"\") + expires + \";path=/;domain=.kenzap.com\"; \n}\n\n/**\n * @name getCookie\n * @description Read cookie by its name.\n * @param {string} cname - Cookie name.\n * \n * @returns {string} value - Cookie value.\n */\nexport const getCookie = (cname) => {\n\n    let name = cname + \"=\";\n    let decodedCookie = decodeURIComponent(document.cookie);\n    let ca = decodedCookie.split(';');\n    for (let i = 0; i < ca.length; i++) {\n        let c = ca[i];\n        while (c.charAt(0) == ' ') {\n            c = c.substring(1);\n        }\n        if (c.indexOf(name) == 0) {\n            return c.substring(name.length, c.length);\n        }\n    }\n    return \"\";\n}\n\n/**\n * @name parseApiError\n * @description Set default logics for different API Error responses.\n * @param {object} object - API response.\n */\nexport const parseApiError = (data) => {\n \n    switch(data.code){\n\n        // unauthorized\n        case 401:\n\n            // dev mode\n            if(window.location.href.indexOf('localhost')){ \n\n                alert(data.reason); \n                return; \n            }\n\n            // production mode\n            location.href=\"https://auth.kenzap.com/?app=65432108792785&redirect=\"+window.location.href; break;\n        \n        // something else\n        default:\n\n            alert(data.reason); \n            break;\n    }\n}\n\n/**\n * @name initBreadcrumbs\n * @description Render ui breadcrumbs.\n * @param {array} data - List of link objects containing link text and url. If url is missing then renders breadcrumb as static text. Requires html holder with .bc class.\n */\nexport const initBreadcrumbs = (data) => {\n\n    let html = '<ol class=\"breadcrumb mt-2 mb-0\">';\n    for(let bc of data){\n        \n        if(typeof(bc.link) === 'undefined'){\n\n            html += `<li class=\"breadcrumb-item\">${ bc.text }</li>`;\n        }else{\n\n            html += `<li class=\"breadcrumb-item\"><a href=\"${ bc.link }\">${ bc.text }</a></li>`;\n        }\n    }\n    html += '</ol>';\n    \n    document.querySelector(\".bc\").innerHTML = html;\n}\n\n/**\n * @name onClick\n * @description One row click event listener declaration. Works with one or many HTML selectors.\n * @param {string} sel - HTML selector, id, class, etc.\n * @param {string} fn - callback function fired on click event.\n */\nexport const onClick = (sel, fn) => {\n\n    if(document.querySelector(sel)) for( let e of document.querySelectorAll(sel) ){\n\n        e.removeEventListener('click', fn, true);\n        e.addEventListener('click', fn, true);\n    }\n}\n\n/**\n * @name onKeyUp\n * @description One row key up event listener declaration. Works with one or many HTML selectors.\n * @param {string} sel - HTML selector, id, class, etc.\n * @param {string} fn - callback function fired on click event.\n */\nexport const onKeyUp = (sel, fn) => {\n\n    if(document.querySelector(sel)) for( let e of document.querySelectorAll(sel) ){\n\n        e.removeEventListener('keyup', fn, true);\n        e.addEventListener('keyup', fn, true);\n    }\n}\n\n/**\n * @name onChange\n * @description One row change event listener declaration. Works with one or many HTML selectors.\n * @param {string} sel - HTML selector, id, class, etc.\n * @param {string} fn - callback function fired on click event.\n */\nexport const onChange = (sel, fn) => {\n\n    if(document.querySelector(sel)) for( let e of document.querySelectorAll(sel) ){\n\n        e.removeEventListener('change', fn, true);\n        e.addEventListener('change', fn, true);\n    }\n}\n\n/**\n * @name loadScript\n * @description Asynchronous script loader function.\n * @param {string} url - HTML selector, id, class, etc.\n * @param {string} cb - callback function fired immediately after script is loaded.\n */\n export const loadScript = (url, cb) => {\n\n    if (!Array.from(document.querySelectorAll('script')).some(elm => elm.src == url)) {\n      let script = document.createElement('script')\n      script.onload = cb\n      script.src = url\n      document.getElementsByTagName('head')[0].appendChild(script)\n    }\n}\n\n/**\n * @name simulateClick\n * @description Trigger on click event without user interaction.\n * @param {string} elem - HTML selector, id, class, etc.\n */\n export const simulateClick = (elem) => {\n\n\t// create our event (with options)\n\tlet evt = new MouseEvent('click', {\n\t\tbubbles: true,\n\t\tcancelable: true,\n\t\tview: window\n\t});\n\n\t// if cancelled, don't dispatch the event\n\t!elem.dispatchEvent(evt);\n};\n\n/**\n * @name toast\n * @description Triggers toast notification. Adds toast html to the page if missing.\n * @param {string} text - Toast notification.\n */\n export const toast = (text) => {\n\n    // only add once\n    if(!document.querySelector(\".toast\")){\n\n        let html = `\n        <div class=\"position-fixed bottom-0 p-2 m-4 end-0 align-items-center\">\n            <div class=\"toast hide align-items-center text-white bg-dark border-0\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\" data-bs-delay=\"3000\">\n                <div class=\"d-flex\">\n                    <div class=\"toast-body\"></div>\n                    <button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\" aria-label=\"Close\"></button>\n                </div>\n            </div>\n        </div>`;\n        if(document.querySelector('body > div')) document.querySelector('body > div').insertAdjacentHTML('afterend', html);\n    }\n\n    let toast = new bootstrap.Toast(document.querySelector('.toast'));\n    document.querySelector('.toast .toast-body').innerHTML = text;  \n    toast.show();\n}","import { getCookie, setCookie } from '@kenzap/k-cloud';\n\nlet products = {};\nlet scroll = {state: 0, last_state: 0, state_prev: 0, fp: 0, el_id: \"\", direction: \"\", offsets: {}, timer: null};\nlet table = '';\nlet spaceID = '';\n\nconst CDN = 'https://kenzap-sites.oss-ap-southeast-1.aliyuncs.com';\nconst appID = '66432108790002';\n\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n\n    setTable();\n\n    initCart();\n\n    getMenu();\n\n    let cb = function(){ console.log('processed'); }\n    authUser(cb, false);\n\n    document.addEventListener(\"scroll\", scrollEvents);\n});\n\n/**\n * Set default table number taken from the QR-code\n * @public\n */\nconst setTable = function(){\n\n    // set current table if provided\n    let urlParams = new URLSearchParams(window.location.search);\n    table = urlParams.get('table') ? urlParams.get('table') : \"\";\n}\n\n/**\n * Show small toast notification\n * @public\n */\nconst toast = function(msg){\n\n    // Get the snackbar DIV\n    let t = document.querySelector(\".kUNwHA .snackbar\");\n    t.innerHTML = msg;\n    t.classList.add(\"show\");\n\n    // After 3 seconds, remove the show class from div\n    setTimeout(function(){ t.className = t.className.replace(\"show\", \"\"); }, 2200);\n}\n\n/**\n * initiate Cart state\n * @public\n */\nconst initCart = function(){\n\n    setBtnStep(1);\n    \n    try{\n        \n        let order = localStorage.cart;\n        \n        if(!order){ order = {created: Math.floor(Date.now() / 1000) }; }else{ order = JSON.parse(order); }\n        if(typeof(order.items) === 'undefined'){ order.items = {}; }\n\n        // check if cart expired 1h session\n        if(order.created+3600 < Math.floor(Date.now() / 1000)) {\n\n            order.items = {};\n            order.created = Math.floor(Date.now() / 1000);\n        }\n\n        cart.state.order = order;\n        // console.log(order);\n    }catch(e){\n        \n        cart.state.order.created = Math.floor(Date.now() / 1000);\n        cart.state.order.items = {};\n    }\n\n    // make sure user ID exists\n    if(!localStorage.idd) localStorage.idd = randomString(8)+Math.floor(Date.now());\n\n    // console.log(cart.state.order);\n    cart.refreshCheckoutButton();\n}\n\n/**\n * Init call to action button listeners\n * @public\n */\nconst btnListeners = function(){\n\n    // continue to table selection\n    document.querySelector(\".kUNwHA .cta-btn .mbtn\").addEventListener('click', function(e) {\n\n        document.querySelector(\"body\").classList.add('kp-modal');\n        refreshDialogView();\n\n        // view cart\n        if(cart.state.order.step == 1){\n\n            viewCheckoutModal();\n            setBtnStep(2);\n            return;\n        }\n        \n        // pick table number view\n        if(cart.state.order.step == 2){\n            \n            // view contents\n            let html = '';\n            html = '<div class=\"ptable\">';\n            html +=\t'<label for=\"table\" style=\"'+(table.length>0?'display:none;':'')+'\">Table number</label>';\n            html +=\t'<input type=\"number\" value=\"'+table+'\" name=\"table\" style=\"'+(table.length>0?'display:none;':'')+'\" autocomplete=\"off\" class=\"table\" size=\"4\" pattern=\"\" inputmode=\"\">';\n            html +=\t'<label for=\"note\">Note</label>';\n            html += '<textarea class=\"note\" name=\"note\" placeholder=\"leave a note for a kitchen\"></textarea>';\n            html +=\t'</div>';\n\n            document.querySelector(\".kUNwHA .cdialog-cnt .kp-body\").innerHTML = html;\n            document.querySelector(\".kUNwHA .cdialog-cnt .ptable .table\").focus();\n\n            setBtnStep(3);\n            return;\n        }\n\n        // finalize checkout\n        if(cart.state.order.step == 3){\n\n            // validate input field\n            let table = document.querySelector(\".kUNwHA .cdialog-cnt .ptable .table\").value;\n            let note = document.querySelector(\".kUNwHA .cdialog-cnt .ptable .note\").value;\n            if(table==\"\"){ alert(\"Please enter table number\"); return; }\n\n            // get note\n            cart.state.order.table = table;\n            cart.state.order.note = note;\n\n            // cache data\n            localStorage.cart = JSON.stringify(cart.state.order);\n\n            // close checkout modal\n            let mdialogCnt = document.querySelector(\".kUNwHA .cdialog-cnt\");\n            mdialogCnt.style.display = \"none\";\n\n            // hide button\n            document.querySelector(\".kUNwHA .cta-btn\").style.display = \"none\";\n\n            // restore body scrolling params\n            closeModal();\n            \n            // send order to backend\n            // let cb = function(){ console.log('processed'); }\n            // authUser(cb, true);\n\n            // auth user to finish checkout\n            let domain = config.domain;\n            if(domain.indexOf('checkout')==-1) domain += (domain.indexOf('?')==-1 ? '?':'&')+'checkout=1';\n            // alert('https://auth.kenzap.com/?app='+appID+'&redirect='+encodeURIComponent(origin));\n            window.location.href = 'https://auth.kenzap.com/?app='+appID+'&redirect='+encodeURIComponent(domain);\n            \n            document.querySelector(\".kUNwHA .overlay\").style.display = \"block\";\n            document.querySelector(\".kUNwHA .overlay .loader\").style.display = \"block\";\n\n            return;\n        }\n\n        // offer sign in\n        if(cart.state.order.step == 4){\n\n            // restore body scrolling params\n            closeModal();\n\n            // window.location.href = 'https://auth.kenzap.com/?redirect=https%3A%2F%2Faccount.kenzap.com%2F%3Flauncher%3Dmenu-orders&idd=' + localStorage.idd;\n            return;\n        }\n    });\n}\n\n/**\n * set button Call to action step\n * @public\n */\nconst setBtnStep = function(step){\n\n    document.querySelector(\".kUNwHA .cta-btn\").style.display = \"block\";\n    switch(step){\n\n        case 1: cart.state.order.step = step; document.querySelector(\".kUNwHA .cta-btn .mbtn\").innerHTML = 'View basket <span class=\"price\">s$0.00</span>'; break;\n        case 2: cart.state.order.step = step; document.querySelector(\".kUNwHA .cta-btn .mbtn\").innerHTML = 'Continue'; break;\n        case 3: cart.state.order.step = step; document.querySelector(\".kUNwHA .cta-btn .mbtn\").innerHTML = 'Checkout';  break;\n        case 4: cart.state.order.step = step; document.querySelector(\".kUNwHA .cta-btn .mbtn\").innerHTML = \"Back to menu\"; break;\n    }\n}\n\n/**\n * Gets menu data\n * @public\n */\nconst getMenu = function(){\n\n    const limit = 1000;\n\n    // let page = getPage(); \n    let offset = 0;\n    let sid = spaceID;\n    \n    fetch('https://api-v1.kenzap.cloud/', {\n        method: 'post',\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'text/plain',\n            'Authorization': 'Bearer ' + API_KEY,\n\n        },\n        body: JSON.stringify({\n            query: {\n                /* user: {\n                    type:       'authenticate',\n                    fields:     ['avatar'],\n                    token:      getCookie('kenzap_token')\n                },\n                locale: {\n                    type:       'locale',\n                    id:         getCookie('lang')\n                },\n                */\n                items: {\n                    type:       'find',\n                    key:        'ecommerce-product',\n                    // sid:        sid,\n                    fields:     ['_id', 'id', 'img', 'status', 'price', 'priced', 'title', 'cats', 'sdesc', 'ldesc', 'variations', 'updated'],\n                    limit:      limit,\n                    offset:     offset,\n                    sortby:     {\n                                    field: 'created',\n                                    order: 'ASC'\n                                }\n                },\n                settings: {\n                    type:       'get',\n                    key:        'qrmenu-settings',\n                    fields:     ['mode', 'palette', 'categories'],\n                }\n            }\n        })\n    })\n    .then(response => response.json())\n    .then(response => {\n\n        if (response.success){\n\n            products = response;\n\n            spaceID = response.sid;\n\n            renderMenu();\n\n            dialogListeners();\n\n            menuListeners();\n\n            sliderListeners();\n\n            btnListeners();\n            \n            console.log(response);\n        \n        }else{\n\n            // parseApiError(response);\n        }\n    })\n    .catch(error => {\n        console.error('Error:', error);\n    });\n}\n\n/**\n * Render menu dialog\n * @public\n */\nconst renderMenu = function(){\n\n    let rows = products.settings.categories.split('\\n');\n    let html_slider = '';\n    let html_menu = '';\n    let title = '';\n\n    for(let c of rows){\n\n        \n        // get values\n        let val = c.split('|');\n        let cat = val[0].trim();\n        let note = val[1] == null ? '' : val[1].trim();\n        console.log(note);\n\n        // render slider\n        html_slider += '<div class=\"slide\" data-href=\"'+convertToSlug(cat)+'\"><a href=\"#'+convertToSlug(cat)+'\" class=\" cl\">'+cat+'</a></div>'; \n\n        // render menu\n        for(let x in products['items']){\n\n            // centralize IDS\n            products['items'][x].id = products['items'][x]._id;\n\n            // skip current loop if current category not present\n            if(typeof(products['items'][x]['cats']) === 'undefined') continue;\n            if(products['items'][x]['cats'] == null) continue;\n            if(!products['items'][x]['cats'].includes(cat)) continue;\n\n            // product image\n            let img = 'https://cdn.kenzap.com/loading.png';\n\n            // load image asyncronously\n            if(products['items'][x]['img'][0] || products['items'][x]['img'][0] == 'true'){\n\n                let imgl = new Image();\n                imgl._id = products['items'][x]['_id'];\n                imgl.onload = function () { console.log('adding'+this.src); document.querySelector(\".kUNwHA .kenzap-row[data-id='\"+this._id+\"'] img\").setAttribute('src', this.src); }\n                imgl.src = CDN + '/S'+spaceID+'/product-'+products['items'][x]['_id']+'-1-250.jpeg?'+products['items'][x]['updated'];\n            }\n\n            // price\n            let price = '<span class=\"tag ptag\">'+priceFormat(products['items'][x]['price'])+'</span>';\n            if(products['items'][x]['priced']!=''){\n\n                price = '<span class=\"ptagc\">'+priceFormat(products['items'][x]['price'])+'</span> <span class=\"tag ptag\">'+priceFormat(products['items'][x]['priced'])+'</span>';\n            }\n\n            let ctag = typeof(cart.state.order.items[products['items'][x]['_id']]) === 'undefined' ? \"\" : cart.state.order.items[products['items'][x]['_id']].qty;\n            let show_heading = '';\n            if(title != cat){ title = cat; show_heading = '<h2 id=\"'+convertToSlug(title)+'\">'+title+'</h2><p class=\"subnote\">'+note+'</p>'; }\n            html_menu += '\\\n            <div class=\"kenzap-row\" data-index=\"'+x+'\" data-id=\"'+products['items'][x]['_id']+'\">\\\n                '+show_heading+'\\\n                <div class=\"info-box\">\\\n                    <div class=\"kenzap-col-7\">\\\n                        <div class=\"kp-content\">\\\n                            <h3><span class=\"tag ctag\">'+ctag+'</span>'+products['items'][x]['title']+'</h3>\\\n                            <p>'+products['items'][x]['sdesc']+'</p>\\\n                            '+price+'\\\n                        </div>\\\n                    </div>\\\n                    <div class=\"kenzap-col-5\">\\\n                        <div class=\"kp-img\">\\\n                            <img src=\"'+img+'\" alt=\"'+products['items'][x]['title']+'\">\\\n                        </div>\\\n                    </div>\\\n                </div>\\\n                \\\n            </div>';\n        }\n    }\n\n    let slider_container = document.querySelector(\".kUNwHA .slideset\");\n    let menu_container = document.querySelector(\".kUNwHA .kenzap-container\");\n    if(html_menu==''){\n        menu_container.innerHTML = \"Please add products and specify categories first\";\n    }else{\n        slider_container.innerHTML = html_slider;\n        menu_container.innerHTML = html_menu;\n    }\t\n}\n\n/**\n * Dialog box listeners\n * @public\n */\nconst dialogListeners = function(){\n\n    let close = document.querySelector(\".kUNwHA .mdialog .close\");\n    close.addEventListener('click', function(e) {\n\n        closeModal();\n    });\n\n    let close2 = document.querySelector(\".kUNwHA .cdialog .close\");\n    close2.addEventListener('click', function(e) {\n\n        let cdialogCnt = document.querySelector(\".kUNwHA .cdialog-cnt\");\n        cdialogCnt.style.display = \"none\";\n\n        setBtnStep(1);\n\n        closeModal();\n    });\n\n    window.addEventListener(\"resize\", refreshDialogView);\n    window.addEventListener(\"orientationchange\", refreshDialogView);\n}\n\n/**\n * Close product popup\n * @public\n */\nconst closeModal = function(){\n\n    let mdialogCnt = document.querySelector(\".kUNwHA .mdialog-cnt\");\n    mdialogCnt.style.display = \"none\";\n\n    document.querySelector(\".kUNwHA .overlay\").style.display = \"none\";\n\n    // allow body scroll\n    document.querySelector(\".kUNwHA .scrollable\").style.height = 'auto';\n    document.querySelector(\".kUNwHA .scrollable\").style.overflowY = 'scroll';\n\n    document.querySelector(\"body\").style.overflowY = 'auto';\n    document.querySelector(\"body\").style.height = 'auto';\n    setTimeout(function(){ document.querySelector(\"body\").classList.remove('kp-modal'); },300);\n\n    document.documentElement.scrollTop = scroll.last_state;\n\n    let cdialogCnt = document.querySelector(\".kUNwHA .cdialog-cnt\");\n    cdialogCnt.style.display = \"none\";\n\n    cart.refreshCheckoutButton();\n}\n\n/**\n * Dialog box listeners\n * @public\n */\nconst refreshDialogView = function(){\n\n    // body prevent scroll\n    if(document.querySelector(\"body\").classList.contains('kp-modal')){\n        document.querySelector(\"body\").style.height = '100vh';\n        document.querySelector(\"body\").style.overflowY = 'hidden';\n        document.querySelector(\".kUNwHA .scrollable\").style.height = '100vh';\n        document.querySelector(\".kUNwHA .scrollable\").style.overflowY = 'hidden';\n        document.querySelector(\".kUNwHA .mdialog-cnt\").style.height = (window.screen.availHeight-160) + \"px\";\n    }\n    // document.querySelector(\".kUNwHA .cdialog-cnt\").style.height = (window.screen.availHeight-160) + \"px\";\n}\n\n/**\n    * Menu horizontal slider listeners listener.\n    * @public\n    */\nconst menuListeners = function(){\n\n    // menu row click listener\n    let row_list = document.querySelectorAll(\".kUNwHA .kenzap-row\");\n    for(const row of row_list){\n\n        row.addEventListener('click', function(e) {\n\n            let x = this.dataset.index; cart.state.index = x;\n            let product_id = products['items'][x].id;\n            let mdialogCnt = document.querySelector(\".kUNwHA .mdialog-cnt\");\n            scroll.last_state = scroll.state;\n\n            // console.log(cart.state.order.items);\n\n            cart.state.total = 0;\n            cart.state.count = 0;\n\n            // update cart state\n            cart.state.product = typeof(cart.state.order.items[product_id]) === 'undefined' ? {id: products['items'][x].id, title: products['items'][x].title, sdesc: products['items'][x].sdesc, index: x, qty: 0, note: \"\", variations:[] }:cart.state.order.items[product_id];\n            \n            // detect product state\n            cart.state.product.type = cart.state.product.qty == 0 ? \"new\" : \"update\";\n            \n            document.querySelector(\"body\").classList.add('kp-modal');\n            // console.log(cart.state.product.variations);\n\n            refreshDialogView();\n\n            let src = (products['items'][x]['img'][0]) ? CDN + '/S'+spaceID+'/product-'+products['items'][x]['_id']+'-1-250.jpeg?'+products['items'][x]['updated'] : 'https://cdn.kenzap.com/loading.png'\n\n\n            // bind data to modal body\n            document.querySelector(\".kUNwHA .mdialog-cnt .mdialog .kp-body > h2\").innerHTML = cart.state.product.title;\n            document.querySelector(\".kUNwHA .mdialog-cnt .mdialog .kp-body > p\").innerHTML = cart.state.product.sdesc;\n            document.querySelector(\".kUNwHA .mdialog-cnt .mdialog .kp-img img\").setAttribute('src', src);\n            document.querySelector(\".kUNwHA .mdialog .qty\").value = cart.state.count = cart.state.product.qty;\t\n            document.querySelector(\".kUNwHA .mdialog .kp-note textarea\").value = cart.state.product.note;\t \n\n            // load image asyncronously\n            var imgl = new Image();\n            imgl.onload = function () { document.querySelector(\".kUNwHA .mdialog-cnt .mdialog .kp-img img\").setAttribute('src', this.src); }\n            imgl.src = CDN + '/S'+spaceID+'/product-'+products['items'][x]['_id']+'-1-500.jpeg?'+products['items'][x]['updated'];\n\n            // \"variations\":[{\"title\":\"Sauce\",\"type\":\"checkbox\",\"required\":\"0\",\"data\":[{\"title\":\"Chilli\",\"price\":\"0.40\",\"cond\":\"\"},{\"title\":\"Teriyaki\",\"price\":\"1.00\",\"cond\":\"\"}]},{\"title\":\"Rice\",\"type\":\"checkbox\",\"required\":\"1\",\"data\":[{\"title\":\"rice\",\"price\":\"0.00\",\"cond\":\"\"},{\"title\":\"cdscdsc\",\"price\":\"0.00\",\"cond\":\"\"}]}]}\n            let html_vars = '';\n            if(typeof(products['items'][x].variations !== 'undefined'))\n            for(let v in products['items'][x].variations){\n\n                // products['items'][x].variations[v].title\n\n                // variation type\n                let type = '';\t\n                if(products['items'][x].variations[v].type=='checkbox') type = 'check';\n                if(products['items'][x].variations[v].type=='radio') \ttype = 'radio';\n\n                // update cart state\n                if(typeof(cart.state.product.variations[v]) === 'undefined') cart.state.product.variations[v] = {title: products['items'][x].variations[v].title, required: products['items'][x].variations[v].required, allow: products['items'][x].variations[v].required == '1'?false:true };\t\n\n                // struct variation\n                html_vars += '\\\n                <h3>'+products['items'][x].variations[v].title+(products['items'][x].variations[v].required == '1' ? ' <span class=\"tag\">required</span>':'')+'</h3>\\\n                <div class=\"kp-'+type+'\">';\n\n                // variation labels\n                for(let d in products['items'][x].variations[v].data){\n\n                    let checked = false;\n                    // console.log(cart.state.product.variations);\n                    if(typeof(cart.state.product.variations[v]) !== 'undefined' && typeof(cart.state.product.variations[v].list) !== 'undefined' && typeof(cart.state.product.variations[v].list[\"_\"+d]) !== 'undefined'){\n\n                        checked = true;\n                        // alert(\"checked\");\n                        // checked = typeof(cart.state.product.variations[v].list[\"_\"+d]) === 'undefined' ? false : true;\n                    }\n                    \n                    switch(type){\n                        case 'check':\n\n                        html_vars += '\\\n                            <label>\\\n                                <input type=\"checkbox\" data-required=\"'+products['items'][x].variations[v].required+'\" data-indexv=\"'+v+'\" data-index=\"'+d+'\" data-title=\"'+products['items'][x].variations[v].data[d]['title']+'\" data-price=\"'+products['items'][x].variations[v].data[d]['price']+'\" '+(checked?'checked=\"checked\"':'')+'>\\\n                                <div class=\"checkbox\">\\\n                                    <svg width=\"20px\" height=\"20px\" viewBox=\"0 0 20 20\">\\\n                                        <path d=\"M3,1 L17,1 L17,1 C18.1045695,1 19,1.8954305 19,3 L19,17 L19,17 C19,18.1045695 18.1045695,19 17,19 L3,19 L3,19 C1.8954305,19 1,18.1045695 1,17 L1,3 L1,3 C1,1.8954305 1.8954305,1 3,1 Z\"></path>\\\n                                        <polyline points=\"4 11 8 15 16 6\"></polyline>\\\n                                    </svg>\\\n                                </div>\\\n                                <span>'+products['items'][x].variations[v].data[d]['title']+'</span>\\\n                                <div class=\"price\">+ '+priceFormat(products['items'][x].variations[v].data[d]['price'])+'</div>\\\n                            </label>';\n                        \n                        break;\n                        case 'radio':\n\n                        html_vars += '\\\n                            <label>\\\n                                <input type=\"radio\" data-required=\"'+products['items'][x].variations[v].required+'\" data-indexv=\"'+v+'\" name=\"radio\" data-index=\"'+d+'\" data-title=\"'+products['items'][x].variations[v].data[d]['title']+'\" data-price=\"'+products['items'][x].variations[v].data[d]['price']+'\" '+(checked?'checked=\"checked\"':'')+' />\\\n                                <span>'+products['items'][x].variations[v].data[d]['title']+'</span>\\\n                                <div class=\"price\">+ '+priceFormat(products['items'][x].variations[v].data[d]['price'])+'</div>\\\n                            </label>';\n                        \n                        break;\n                    }\n                }\n\n                html_vars += '</div>';\n\n                // html_var = '\\\n                // <h3>'+products['items'][x].variations[v].title+' '+(products['items'][x].variations[v].required == '1' ? '<span class=\"tag\">required</span>':'')+'</h3>\\\n                // <div class=\"kp-'+type+'\">\\\n                // \t'+labels+'\\\n                // </div>';\n            }\n\n            document.querySelector(\".kUNwHA .mdialog-cnt .mdialog .kp-vars\").innerHTML = html_vars;\n\n            cart.refreshButton();\n            \n            mdialogCnt.style.display = \"block\";\n            document.querySelector(\".kUNwHA .overlay\").style.display = \"block\";\n    \n            // checkbox listener\n            let checkbox_list = document.querySelectorAll(\".kUNwHA .mdialog .kp-check input[type=checkbox]\");\n            for(const cb of checkbox_list){\n                cb.addEventListener('change', function() {\n\n                    console.log(\"call refreshButton\");\n\n                    let v = parseInt(cb.dataset.indexv);\n                    // if(typeof(cart.state.product.variations[v].list) === 'undefined') \n                    cart.state.product.variations[v].list = {};\n\n                    let count = 0;\n                    for(const cbg of document.querySelectorAll(\".kUNwHA .mdialog .kp-check input[type=checkbox][data-indexv='\"+v+\"']\")){\n\n                        // checks if this block is required and allows checkout\n                        if(cb.dataset.required==\"1\"){ if(count) cart.state.product.variations[v].allow = true; }else{ cart.state.product.variations[v].allow = true; }\n\n                        // cache selected variations\n                        if(cbg.checked){ cart.state.product.variations[v].list[\"_\"+cbg.dataset.index] = {title: cbg.dataset.title, price: parseFloat(cbg.dataset.price) }; count +=1; }\n                    }\n                    \n                    // console.log(cart.state.product.variations);\n                    cart.refreshButton();\n                });\n            }\n\n            // radio listener\n            let radio_list = document.querySelectorAll(\".kUNwHA .mdialog .kp-radio input[type=radio]\");\n            for(const cb of radio_list){\n                cb.addEventListener('change', function() {\n\n                    console.log(\"call refreshButton\");\n\n                    let v = parseInt(cb.dataset.indexv);\n                    // if(typeof(cart.state.product.variations[v].list) === 'undefined') \n                    cart.state.product.variations[v].list = {};\n\n                    let count = 0;\n                    for(const rag of document.querySelectorAll(\".kUNwHA .mdialog .kp-radio input[type=radio][data-indexv='\"+v+\"']\")){\n                    \n                        // cache selected variations\n                        if(rag.checked){ cart.state.product.variations[v].list[\"_\"+rag.dataset.index] = {title: rag.dataset.title, price: parseFloat(rag.dataset.price) }; count +=1; }\n                        \n                        // checks if this block is required and allows checkout\n                        if(cb.dataset.required==\"1\"){ if(count) cart.state.product.variations[v].allow = true; }else{ cart.state.product.variations[v].allow = true; }\n                    }\n\n                    // console.log(cart.state.product.variations);\n\n                    cart.refreshButton();\n                });\n            }\n        });\n        // cart.refreshButton();\n        // console.log(cart.state.product);\n    }\n\n    // plus click listener\n    let qty = document.querySelector(\".kUNwHA .mdialog .qty\");\n    let plus = document.querySelector(\".kUNwHA .mdialog .plus\");\n    plus.addEventListener('click', function(e) {\n\n        if(cart.state.count < config.cart.max_addition) cart.state.count +=1;\n        qty.value = cart.state.count;\n        cart.refreshButton();\n        vibrate();\n    });\n    \n    // minus click listener\n    let minus = document.querySelector(\".kUNwHA .mdialog .minus\");\n    minus.addEventListener('click', function(e) {\n\n        if(cart.state.count > 0) cart.state.count -=1;\n        qty.value = cart.state.count;\n        cart.refreshButton();\n        vibrate();\n    });\n\n    // add to cart listener\n    let add = document.querySelector(\".kUNwHA .mdialog .add\");\n    add.addEventListener('click', function(e) {\n\n        if(this.parentNode.classList.contains(\"dis\")){ alert(\"Please select required fields\"); return; }\n        cart.addToCart();\n        // cart.resetButton(); \n        closeModal();\n        toast(\"Cart updated\");\n        vibrate();\n    });\n\n    // checkout  button listener\n    // let checkout = document.querySelector(\".kUNwHA .vadd\");\n    // checkout.addEventListener('click', function(e) {\n\n    // \tviewCheckoutModal();\n    // });\n}\n\n/**\n    * view checkout modal\n    * @public\n    */\nconst viewCheckoutModal = function(){\n\n    let cdialogCnt = document.querySelector(\".kUNwHA .cdialog-cnt\");\n\n    refreshDialogView();\n\n    cdialogCnt.style.display = \"block\";\n    document.querySelector(\".kUNwHA .overlay\").style.display = \"block\";\n\n    // generate cart table\n    let html = '<table>';\n    let total = 0;\n    for(let p in cart.state.order.items){\n\n        // console.log(cart.state.order.items[p].priceF);\n        total += parseFloat(cart.state.order.items[p].priceF);\n        html += '<tr><td data-id=\"'+cart.state.order.items[p].id+'\" class=\"checkt\">'+cart.state.order.items[p].qty+' x '+cart.state.order.items[p].title+'</td><td></td><td class=\"price\"><strong>'+priceFormat(cart.state.order.items[p].price)+'</strong></td></tr>';\n    }\n\n    html += '<tr><td class=\"summ\" colspan=\"3\">Total <strong>'+priceFormat(total)+'</strong></td></tr>';\n    html += '</table>';\n\n    cdialogCnt.querySelector(\".kUNwHA .cdialog-cnt .kp-body\").innerHTML = html;\n\n    // remove item from cart\n    for(const td of cdialogCnt.querySelectorAll(\".kUNwHA .cdialog-cnt .kp-body .checkt\")){\n\n        td.addEventListener('click', function(e) {\n\n            let c = confirm(\"Remove \"+this.innerHTML + \"?\");\n            if(c){\n\n                document.querySelector(\".kUNwHA .kenzap-row[data-id='\"+this.dataset.id+\"'] .ctag\").innerHTML = \"\";\n                cart.removeFromCart(this.dataset.id);\n                cart.refreshCheckoutButton();\n\n                // console.log(cart.state.order.items);\n                if(Object.keys(cart.state.order.items).length == 0){\n\n                    setBtnStep(1);\n                    // console.log(\"closeModal\"); \n                    closeModal(); \n                    return; \n                }\n                viewCheckoutModal();\n                setBtnStep(2);\n            }\n        });\n    }\t\n}\n\n/**\n    * view thank you modal\n    * @public\n    */\nconst viewThankyouModal = function(){\n\n    let tdialogCnt = document.querySelector(\".kUNwHA .cdialog-cnt\");\n\n    refreshDialogView();\n\n    tdialogCnt.style.display = \"block\";\n    document.querySelector(\".kUNwHA .overlay\").style.display = \"block\";\n\n    // generate cart table\n    let html = '<div>';\n    html += '<h3>Order received!</h3>';\n    html += '<p>Thank you for your order, you can close the window or return to the menu.</p>';\n    html += '<lottie-player src=\"https://assets8.lottiefiles.com/packages/lf20_fefIZO.json\"  background=\"transparent\"  speed=\"1\" class=\"lplayer\" style=\"width: 300px; height: 300px;\" loop  autoplay></lottie-player>';\n    html += '</div>';\n\n    tdialogCnt.querySelector(\".kUNwHA .cdialog-cnt .kp-body\").innerHTML = html;\n}\n\n/**\n    * send checkout data to backend\n    * @public\n    */\nconst authUser = function(cb, force){\n        \n    let urlParams = new URLSearchParams(window.location.search);\n    let ott = urlParams.get('ott') ? urlParams.get('ott') : \"\";\n    \n    let params = new URLSearchParams();\n        params.append(\"cmd\", \"get_state\");\n        params.append(\"app\", appID);\n        params.append(\"ott\", ott);\n        params.append(\"token\", getCookie('kenzap_token'));\n\n    // do API query\n    fetch('https://api-v1.kenzap.cloud/auth/', {\n        method: 'post',\n        headers: {\n            'Accept': 'application/json',\n            'Content-type': 'application/x-www-form-urlencoded',\n            // 'Authorization': 'Bearer ' + getCookie('kenzap_api_key'),\n        },\n        body: params\n    })\n    .then(response => response.json())\n    .then(response => {\n \n        console.log(response);\n  \n        let checkout = urlParams.get('checkout') ? urlParams.get('checkout') : \"\";\n        if(!checkout) return;\n\n        if(response.success){\n\n            if(response.token){ setCookie('kenzap_token', response.token, 1); console.log('setting up token'); }\n\n            // let table = 5;\n            cart.state.order.kid = response.kid;\n            cart.state.order.name = response.name;\n            cart.state.order.from = table+' - '+response.name;\n            cart.state.order.status = 'new';\n\n            // DO CHECKOUT\n            // cb.call();\n            ajaxCheckout();\n        }else{\n\n            alert('Oops, something went wrong. Please try checking out again.');\n \n            // DO AUTH\n            // if(force) window.location.href = 'https://auth.kenzap.com/?app='+appID+'&redirect='+encodeURI(window.location.href);\n            // window.location.href = 'https://auth.kenzap.com/?app='+appID;\n            // https://auth.kenzap.com/?app=66432108790001\n        }\n    })\n    .catch(error => {\n        console.error('Error:', error);\n    });\n}\n\n/**\n    * send checkout data to backend\n    * @public\n    */\nconst ajaxCheckout = function(){\n\n    cart.state.order.idd = localStorage.idd;\n    cart.state.order.sid = spaceID;\n    cart.state.order.id = (typeof(cart.state.order.id) === 'undefined' ? randomString(8)+Math.floor(Date.now()) : cart.state.order.id);\n\n    // alert(cart.state.order.id);\n    let kenzap_api_key = 'DoSTdhxk6BTIHiYno9XhZ4zorh0ak0MRGMH5T2iP2h1BNo3MtA69irZJp3pZuaiA';\n\n    // do API query\n    fetch('https://api-v1.kenzap.cloud/', {\n        method: 'post',\n        headers: {\n            'Accept': 'application/json',\n            'Content-type': 'application/x-www-form-urlencoded',\n            // 'Authorization': 'Bearer ' + kenzap_api_key,\n            'Kenzap-Token': getCookie('kenzap_token'),\n            'Kenzap-Sid': spaceID,\n        },\n        body: JSON.stringify({\n            query: {\n                order: {\n                    type:       'create',\n                    key:        'ecommerce-order',        \n                    sid:        spaceID,\n                    data:       cart.state.order\n                }\n            }\n        })\n    })\n    .then(response => response.json())\n    .then(response => {\n\n        if(response.success){\n\n            viewThankyouModal();\n\n            // reset cart\n            cart.clearCart();\n\n            // next step\n            setBtnStep(4);\n        }else{\n\n            alert(\"Error occured. Please try again!\");\n        }\n    })\n    .catch(error => {\n        console.error('Error:', error);\n    });\n}\n\n/**\n    * trigger small vibration effect when user interacts with UI\n    * @public\n    */\n    const vibrate = function(){\n\n    if (window.navigator && window.navigator.vibrate) {\n        // Vibrate once for 1 second\n        navigator.vibrate(20);\n    }\n}\n\n/**\n    * Menu horizontal slider listeners.\n    * @public\n    */\nconst sliderListeners = function(){\n\n    let slide_list = document.querySelectorAll(\".kUNwHA .slideset .slide\");\n    for(const slide of slide_list){\n\n        // offsetLeft\n        let scrollDiv = slide.offsetLeft;\n        scroll.offsets[slide.dataset.href] = scrollDiv;\n        slide.addEventListener('click', function(e) {\n\n            let sto = document.documentElement.scrollTop;\n            // document.documentElement.scrollTop = sto-=10;\n            setTimeout(function(el){\n\n                for (const l of document.querySelectorAll(\".kUNwHA .slide\")){ l.classList.remove(\"active\"); }\n                el.classList.add(\"active\");\n                // document.documentElement.scrollTop = sto+=10;\n            },250, this)\n        });\n    }\n}\n\n/**\n    * Scroll listener. Add/Remove scrolled class to body\n    * @public\n    */\n    const scrollEvents = function() {\n\n    // console.log(document.documentElement.scrollTop);\n    let h_list = document.querySelectorAll(\".kUNwHA .kenzap-row h2\");\n    let s_id = \"\";\n    let diff_prev = 0;\n    let diff = 0;\n    scroll.state = document.documentElement.scrollTop;\n\n    for (const h of h_list){\n\n        diff = (h.offsetTop - document.documentElement.scrollTop);\n        \n        // scrolling up\n        // if(scroll.state<scroll.state_prev){\n\n        // \tscroll.direction = \"up\";\n        // \tif(diff>0){\n                \n        // \t\tif(scroll.el_id == \"\") scroll.el_id = h.id;\n        // \t\tif(diff_prev > diff){ console.log(diff + \" \" +h.id); diff = diff_prev; scroll.el_id = h.id; }\n        // \t}\n        // }\n\n        // scrolling down\n        // if(scroll.state>scroll.state_prev){\n\n            scroll.direction = \"down\";\n            if(diff<0){\n\n                if(diff_prev > diff){ diff = diff_prev; scroll.el_id = h.id; }\n            }\n    \n            // if(diff>0){\n\n            // }\n        // }\n\n        diff_prev = diff;\n    }\n\n    // save previous scroll state\n    if(scroll.state_prev!=scroll.state) scroll.state_prev = scroll.state;\n\n    if(scroll.el_id!=\"\"){\n\n        let sc = document.querySelector(\".kUNwHA .cata-sub-nav\");\n        if(scroll.timer) clearTimeout(scroll.timer);\n        scroll.timer = setTimeout((el_id) => {\n\n            sc.scrollTo({ left: scroll.offsets[el_id], behavior: 'smooth'});\n\n            for (const l of document.querySelectorAll(\".kUNwHA .slide\")){ l.classList.remove(\"active\"); }\n            document.querySelector(\".kUNwHA [data-href='\"+el_id+\"']\").classList.add(\"active\");\n\n        }, 200, scroll.el_id);\n    }\n\n    scroll.el_id = \"\";\n}\n\n/**\n    * Convert text to url friendly slug \n    * @public\n    */\nconst convertToSlug = function(str) {\n\n    return str\n        .toLowerCase()\n        .replace(/[^\\w ]+/g,'')\n        .replace(/ +/g,'-')\n        ;\n}\n\n/**\n    * Render price\n    * @public\n    */\nconst priceFormat = function(price) {\n\n    let priceF = parseFloat(price).toFixed(2);\n\n    switch(config.price.style){\n        case 'left': priceF = config.price.symbol + priceF; break;\n        case 'right': priceF = priceF + config.price.symbol; break;\n    }\n\n    return priceF;\n}\n\n/**\n    * Generates a random string\n    * \n    * @param int length_\n    * @return string\n    */\nconst randomString = function(length_) {\n\n    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghiklmnopqrstuvwxyz'.split('');\n    if (typeof length_ !== \"number\") {\n        length_ = Math.floor(Math.random() * chars.length_);\n    }\n    var str = '';\n    for (var i = 0; i < length_; i++) {\n        str += chars[Math.floor(Math.random() * chars.length)];\n    }\n    return str;\n}\n\n/**\n    * Get cookie by name\n    * @param cname cookie name\n    * @public\n    */\n// const getCookie = (cname) => {\n\n//     let name = cname + \"=\";\n//     let decodedCookie = decodeURIComponent(document.cookie);\n//     let ca = decodedCookie.split(';');\n//     for (let i = 0; i < ca.length; i++) {\n//         let c = ca[i];\n//         while (c.charAt(0) == ' ') {\n//             c = c.substring(1);\n//         }\n//         if (c.indexOf(name) == 0) {\n//             return c.substring(name.length, c.length);\n//         }\n//     }\n//     return \"\";\n// }\n\n/**\n    * Cart and checkout functions\n    * @public\n    */\nlet cart = {\n\n    state: {total: 0, count: 0, index: 0, product: { variations: [] }, order: {} },\n    // order:{total: 0, items: []},\n    resetButton: function(){\n\n        // document.querySelector(\".kUNwHA .qty\").value = 0;\n        this.state.total = 0;\n        this.state.count = 0;\n        // this.state.product = { variations: [] };\n        // this.refreshButton();\n    },\n    refreshButton: function(){\n\n        // price | get base product price\n        this.state.product.qty = parseInt(document.querySelector(\".kUNwHA .qty\").value);\n        this.state.product.price = products['items'][this.state.index].priced == \"\" ? parseFloat(products['items'][this.state.index].price) : parseFloat(products['items'][this.state.index].priced);\n\n        // get note\n        this.state.product.note = document.querySelector(\".kUNwHA .kp-note textarea\").value;\n\n        // price | calculate upon checkbox variations\n        let cb_count = 0;\n        let checkbox_list = document.querySelectorAll(\".kUNwHA .mdialog .kp-check input[type=checkbox]\");\n        for(const cb of checkbox_list){ if(cb.checked){ cb_count++; this.state.product.price+=parseFloat(cb.dataset.price);  } } //console.log(\"CB: \" + parseFloat(cb.dataset.price));\n\n        // price | calculate upon radio variations\n        let ra_count = 0;\n        let radio_list = document.querySelectorAll(\".kUNwHA .mdialog .kp-radio input[type=radio]\");\n        for(const ra of radio_list){ if(ra.checked){ ra_count++; this.state.product.price+=parseFloat(ra.dataset.price); } } //console.log(\"RA: \" + parseFloat(ra.dataset.price)); \n\n        // price | assign to button\n        this.state.product.priceF = parseFloat((this.state.product.price*this.state.product.qty));\n        document.querySelector(\".kUNwHA .add .price\").innerHTML = priceFormat(this.state.product.priceF);\n\n        // define button state, enabled, disabled\n        let dis = false;\n        if(this.state.product.priceF==0) dis = true;\n        for(v in cart.state.product.variations){ if(cart.state.product.variations[v].allow == false) dis = true; }\n\n        // define button text\n        // console.log(cart.state.product.type);\n        document.querySelector(\".kUNwHA .kp-add .mbtn .add\").style.background = \"\";\n        if(cart.state.product.type == 'update' && this.state.product.qty > 0){ document.querySelector(\".kUNwHA .kp-add .mbtn .cta\").innerHTML = \"Update\"; }\n        if(cart.state.product.type == 'update' && this.state.product.qty == 0){ document.querySelector(\".kUNwHA .kp-add .mbtn .cta\").innerHTML = \"Remove\"; document.querySelector(\".kUNwHA .kp-add .btn .add\").style.background=\"#df1960\"; dis = false; }\n        if(cart.state.product.type == 'new'){ document.querySelector(\".kUNwHA .kp-add .mbtn .cta\").innerHTML = \"Add\"; }\n\n        // refresh UI\n        if(dis){ document.querySelector(\".kUNwHA .kp-add .mbtn\").classList.add(\"dis\"); }else{ document.querySelector(\".kUNwHA .kp-add .mbtn\").classList.remove(\"dis\"); }\n    },\n    refreshCheckoutButton: function(){\n\n        // console.log(this.state.order.items);\n        let total = 0;\n        for(let p in this.state.order.items){\n\n            // console.log(this.state.order.items[p].priceF);\n            total += parseFloat(this.state.order.items[p].priceF);\n        }\n\n        this.state.order.total = total;\n\n        // trigger visibility\n        if(total>0) {\n\n            document.querySelector(\"body\").classList.add(\"cbtn\");\n            \n            setBtnStep(1);\n\n            document.querySelector(\".kUNwHA .cta-btn .price\").innerHTML = priceFormat(total);\n        }else{\n            document.querySelector(\".kUNwHA .cta-btn\").style.display = \"none\";\n            document.querySelector(\"body\").classList.remove(\"cbtn\");\n        }\n    },\n    addToCart: function(){\n\n        // sync UI with data\n        // this.refreshButton();\n\n        // add to cart\n        this.state.order.items[this.state.product.id] = this.state.product; // push(this.state.product);\n\n        console.log(this.state.order.items);\n\n        // remove from cart\n        if(this.state.product.qty==0){ this.removeFromCart(this.state.product.id); }else{ document.querySelector(\".kUNwHA .kenzap-row[data-id='\"+this.state.product.id+\"'] .ctag\").innerHTML = this.state.product.qty; }\n\n        // cache results\n        localStorage.cart = JSON.stringify(this.state.order);\n\n        // setBtnStep(1);\n        cart.refreshCheckoutButton();\n        \n    },\n    removeFromCart: function(id){\n\n        delete this.state.order.items[id];\n\n        document.querySelector(\".kUNwHA .kenzap-row[data-id='\"+id+\"'] .ctag\").innerHTML = \"\";\n \n        // cache results\n        localStorage.cart = JSON.stringify(this.state.order);\n    },\n    clearCart: function(){\n\n        // clear cart and refresh UI\n        for(let i in cart.state.order.items){  document.querySelector(\".kUNwHA .kenzap-row[data-id='\"+cart.state.order.items[i].id+\"'] .ctag\").innerHTML = \"\"; }\n\n        // reser cached dara\n        cart.state.order = {};\n        cart.state.order.created = Math.floor(Date.now() / 1000);\n        cart.state.order.items = {};\n\n        localStorage.cart = JSON.stringify(cart.state.order);\n\n        // refresh cart button \n        this.refreshCheckoutButton();\n\n        // remove checkoout request from url\n        window.history.replaceState({}, document.title, config.domain);\n    }\n}"],"names":["products","scroll","state","last_state","state_prev","fp","el_id","direction","offsets","timer","table","spaceID","CDN","appID","document","addEventListener","setTable","initCart","getMenu","cb","console","log","authUser","scrollEvents","urlParams","URLSearchParams","window","location","search","get","toast","msg","t","querySelector","innerHTML","classList","add","setTimeout","className","replace","setBtnStep","order","localStorage","cart","created","Math","floor","Date","now","JSON","parse","items","e","idd","randomString","refreshCheckoutButton","btnListeners","refreshDialogView","step","viewCheckoutModal","html","length","focus","value","note","alert","stringify","mdialogCnt","style","display","closeModal","domain","config","indexOf","href","encodeURIComponent","limit","offset","fetch","method","headers","API_KEY","body","query","type","key","fields","sortby","field","settings","then","response","json","success","sid","renderMenu","dialogListeners","menuListeners","sliderListeners","error","rows","categories","split","html_slider","html_menu","title","c","val","cat","trim","convertToSlug","x","id","_id","includes","img","imgl","Image","onload","src","setAttribute","price","priceFormat","ctag","qty","show_heading","slider_container","menu_container","close","close2","cdialogCnt","height","overflowY","remove","documentElement","scrollTop","contains","screen","availHeight","row_list","querySelectorAll","row","dataset","index","product_id","total","count","product","sdesc","variations","html_vars","v","required","allow","d","data","checked","list","refreshButton","checkbox_list","parseInt","indexv","cbg","parseFloat","radio_list","rag","plus","max_addition","vibrate","minus","parentNode","addToCart","p","priceF","td","confirm","removeFromCart","Object","keys","viewThankyouModal","tdialogCnt","force","ott","params","append","getCookie","checkout","token","setCookie","kid","name","from","status","ajaxCheckout","clearCart","navigator","slide_list","slide","scrollDiv","offsetLeft","sto","el","l","h_list","diff_prev","diff","h","offsetTop","sc","clearTimeout","scrollTo","left","behavior","str","toLowerCase","toFixed","symbol","length_","chars","random","i","resetButton","priced","cb_count","ra_count","ra","dis","background","history","replaceState"],"mappings":"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"}